metadata:
  name: "Require Disabled Key Versions Before Destruction"
  id: "CCOE_GCP_KMS_DISABLE_BEFORE_DESTROY"
  category: "encryption"
  severity: "HIGH"
  description: "Ensure that Google Cloud KMS key versions are set to `DISABLED` before being destroyed."

definition:
  and:
    - cond_type: "attribute"
      resource_types:
        - "google_workbench_instance"
      attribute: "access_configs"
      operator: "not_exists"
    - cond_type: "attribute"
      resource_types:
        - "google_workbench_instance"
      attribute: "disable_public_ip"
      operator: "equals"
      value: true
