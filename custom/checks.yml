metadata:
  name: "Restrict Public IP Access on Vertex AI Workbench Notebooks and Instances"
  id: "CCOE_GCP_VERTEXAI_RESTRICT_PUBLIC_IP"
  category: "networking"
  severity: "HIGH"
  description: "Ensure Vertex AI Workbench instances have public IP access disabled by setting disable_public_ip to true and removing any access_config blocks."

definition:
  and:
    - cond_type: "attribute"
      resource_types:
        - "google_workbench_instance"
      # attribute: "gce_setup.*.network_interfaces.*.access_configs"
      attribute: "gce_setup.network_interfaces.access_configs"
      operator: "not_exists"
    - cond_type: "attribute"
      resource_types:
        - "google_workbench_instance"
      attribute: "gce_setup.disable_public_ip"
      operator: "equals"
      value: true
