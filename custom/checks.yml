metadata:
  name: "Disable IPv6 usage in GCP network resources"
  id: "CCOE_GCP_DISABLE_IPV6"
  category: "security"
  severity: "HIGH"
  description: "Ensure all IPv6 are disabled"



definition:
  or:
    - and:
      - cond_type: "attribute"
        resource_types:
          - "azurerm_cognitive_account"
        attribute: "public_network_access_enabled"
        operator: "exists"
      - cond_type: "attribute"
        resource_types:
          - "azurerm_cognitive_account"
        attribute: "public_network_access_enabled"
        operator: "equals"
        value: "false"
      - cond_type: "attribute"
        resource_types:
          - "azurerm_cognitive_account"
        attribute: "network_acls.default_action"
        operator: "equals"
        value: "Deny"
    - and: 
      - cond_type: "attribute"
        resource_types:
          - "azurerm_search_service"
        attribute: "public_network_access_enabled"
        operator: "exists"
      - cond_type: "attribute"
        resource_types:
          - "azurerm_search_service"
        attribute: "public_network_access_enabled"
        operator: "equals"
        value: "false"
# definition:
#   or:
#     - or:
#         - cond_type: "attribute"
#           resource_types:
#             - "google_compute_subnetwork"
#             - "google_compute_instance"
#           attribute: "network_interface.stack_type"
#           operator: "not_exists"
#         - cond_type: "attribute"
#           resource_types:
#             - "google_compute_subnetwork"
#             - "google_compute_instance"
#           attribute: "network_interface.stack_type"
#           operator: "equals"
#           value: "IPV4_ONLY"

# definition:
#   and:
#     - or:
#         - cond_type: "attribute"
#           resource_types:
#             - "google_compute_subnetwork"
#           attribute: "stack_type"
#           operator: "not_exists"
#         - cond_type: "attribute"
#           resource_types:
#             - "google_compute_subnetwork"
#           attribute: "stack_type"
#           operator: "equals"
#           value: "IPV4_ONLY"
#     - or:
#         - cond_type: "attribute"
#           resource_types:
#             - "google_compute_instance"
#           attribute: "network_interface.stack_type"
#           operator: "not_exists"
#         - cond_type: "attribute"
#           resource_types:
#             - "google_compute_instance"
#           attribute: "network_interface.stack_type"
#           operator: "equals"
#           value: "IPV4_ONLY"
# definition:
#   and:
#     - or:
#         - cond_type: "attribute"
#           resource_types:
#             - "google_compute_subnetwork"
#           attribute: "stack_type"
#           operator: "not_exists"
#         - cond_type: "attribute"
#           resource_types:
#             - "google_compute_subnetwork"
#           attribute: "stack_type"
#           operator: "equals"
#           value: "IPV4_ONLY"
#     - or:
#         - cond_type: "attribute"
#           resource_types:
#             - "google_compute_instance"
#           attribute: "network_interface.stack_type"
#           operator: "not_exists"
#         - cond_type: "attribute"
#           resource_types:
#             - "google_compute_instance"
#           attribute: "network_interface.stack_type"
#           operator: "equals"
#           value: "IPV4_ONLY" 
    # - or:
    #     - cond_type: "attribute"
    #       resource_types:
    #         - "google_compute_instance"
    #       attribute: "stack_type"
    #       operator: "not_exists"
    #     - cond_type: "attribute"
    #       resource_types:
    #         - "google_compute_instance"
    #       attribute: "stack_type"
    #       operator: "equals"
    #       value: "IPV4_ONLY"      
          
    # - cond_type: "attribute"
    #   resource_types:
    #     - "google_compute_subnetwork"
    #   attribute: "ipv6_access_type"
    #   operator: "not_exists"
      
    # - or:
    #     - cond_type: "attribute"
    #       resource_types:
    #         - "google_compute_subnetwork"
    #       attribute: "ipv6_cidr_range"
    #       operator: "not_exists"
    #     - cond_type: "attribute"
    #       resource_types:
    #         - "google_compute_subnetwork"
    #       attribute: "ipv6_cidr_range"
    #       operator: "not_regex_match"
    #       value: "*:*"  # No IPv6 CIDRs allowed
          
     

    # - cond_type: "attribute"
    #   resource_types:
    #     - "google_compute_instance"
    #   attribute: "ipv6_access_config"
    #   operator: "not_exists"

    # - or:
    #     - cond_type: "attribute"
    #       resource_types:
    #         - "google_compute_instance"
    #       attribute: "alias_ip_range.ip_cidr_range"
    #       operator: "not_exists"
    #     - cond_type: "attribute"
    #       resource_types:
    #         - "google_compute_instance"
    #       attribute: "alias_ip_range.ip_cidr_range"
    #       operator: "not_regex_match"
    #       value: "*:*"
    # - or:
    #     - cond_type: "attribute"
    #       resource_types:
    #         - "google_compute_network"
    #       attribute: "enable_ula_internal_ipv6"
    #       operator: "not_exists"
    #     - cond_type: "attribute"
    #       resource_types:
    #         - "google_compute_network"
    #       attribute: "enable_ula_internal_ipv6"
    #       operator: "not_equals"
    #       value: true
  
    # - cond_type: "attribute"
    #   resource_types:
    #     - "google_compute_network"
    #   attribute: "internal_ipv6_range"
    #   operator: "not_exists"
