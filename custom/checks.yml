metadata:
  name: "Disable VM Serial Port Logging to Stackdriver"
  id: "CCOE_GCP_DISABLE_SERIAL_PORT_LOGGING"
  category: "security"
  severity: "MEDIUM"
  description: "Ensure VM serial port logging to Stackdriver is disabled."

definition:
   or:
      - or:
           - cond_type: "attribute"
             resource_types:
                - "google_compute_instance"
                - "google_compute_project_metadata"
             attribute: "metadata.serial-port-logging-enable"
             operator: "not_exists"
           - cond_type: "attribute"
             resource_types:
                - "google_compute_instance"
                - "google_compute_project_metadata"
             attribute: "metadata.serial-port-logging-enable"
             operator: "equals"
             value: false
      - or:
           - cond_type: "attribute"
             resource_types:
                - "google_compute_project_metadata_item"
             attribute: "key"
             operator: "not_equals"
             value: "serial-port-logging-enable"
           - and:
                - cond_type: "attribute"
                  resource_types:
                     - "google_compute_project_metadata_item"
                  attribute: "key"
                  operator: "equals"
                  value: "serial-port-logging-enable"
                - cond_type: "attribute"
                  resource_types:
                     - "google_compute_project_metadata_item"
                  attribute: "value"
                  operator: "equals"
                  value: false
